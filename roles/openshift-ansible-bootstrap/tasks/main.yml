---

# Was pointed @ http://red.ht/2rNperO
# but... that's only for atomic host.
# now going to...

# - name: Remove default docker packages
#   yum:
#     name: "{{ item }}"
#     state: absent
#   with_items:
#     - docker
#     - docker-common
#     - docker-selinux
#     - docker-engine

- name: Stop docker
  service:
    name: docker
    state: stopped
  ignore_errors: yes

- name: Remove /var/lib/docker
  file:
    dest: /var/lib/docker
    state: absent

- name: install pre-reqs
  yum: 
    name: "{{ item }}"
    state: present
  with_items:
    - yum-utils 
    - device-mapper-persistent-data 
    - lvm2

- name: Add docker yum repo
  shell: >
    yum-config-manager 
    --add-repo https://download.docker.com/linux/centos/docker-ce.repo

- name: Install upstream docker (assumes you DO NOT have default Docker installed!)
  yum:
    name: docker-ce
    state: present

- name: Make sure /etc/docker exists
  file:
    dest: /etc/docker
    state: directory

- name: Template Docker's daemon.json
  template:
    src: daemon.json.j2
    dest: /etc/docker/daemon.json


- name: Start and enable docker
  service:
    name: docker
    enabled: yes
    state: started

